{% extends "base.html" %}
{% block content %}
<ul>
            {% for message in messages %}
                <li class="bg-green-500 text-white px-1 py-2">{{message}}</li>
            {% endfor %}
</ul>
<div class="container mx-auto px-4 py-8">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-10">
        <a href="?view=events" class="p-8 border border-orange-800 bg-orange-300 rounded-xl shadow-lg transform transition-all hover:bg-orange-600 hover:-translate-y-3">
            <h2 class='text-xl font-bold'>Events: {{ total_events }}</h2>
        </a>
        <a href="?view=groups" class="p-8 border border-orange-800 bg-orange-300 rounded-xl shadow-lg transform transition-all hover:bg-orange-600 hover:-translate-y-3">
            <h2 class='text-xl font-bold'>Groups: {{ total_groups }}</h2>
        </a>
        <a href="?view=categories" class="p-8 border border-orange-800 bg-orange-300 rounded-xl shadow-lg transform transition-all hover:bg-orange-600 hover:-translate-y-3">
            <h2 class='text-xl font-bold'>Categories: {{ total_categories }}</h2>
        </a>
        <a href="?view=participants" class="p-8 border border-orange-800 bg-orange-300 rounded-xl shadow-lg transform transition-all hover:bg-orange-600 hover:-translate-y-3">
            <h2 class='text-xl font-bold'>Users: {{ total_participants }}</h2>
        </a>
    </div>

    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
        
        <div class='flex justify-between items-center mb-10'>
           <h3 class="text-2xl font-bold text-gray-800">{{ list_title }}</h3>
           
           {% if filter_type == 'events' %}
            <a href="{% url 'create-event' %}" class="bg-green-500 py-2 px-4 rounded-3xl text-white hover:bg-green-600 transition">
                + Add a New Event
            </a>
           {% elif filter_type == 'groups' %}
            <a href="{% url 'create-group' %}" class="bg-green-500 py-2 px-4 rounded-3xl text-white hover:bg-green-600 transition">
                + Add a New Group
            </a>
           {% elif filter_type == 'categories' %}
            <a href="{% url 'create-category' %}" class="bg-green-500 py-2 px-4 rounded-3xl text-white hover:bg-green-600 transition">
                + Add a New Category
            </a>
           {% endif %}
        </div>

        {% if filter_type == 'events' %}
            <div class="space-y-4">
                {% for event in items %}
                    <div class="border-b pb-4 flex justify-between items-center last:border-0">
                        <div>
                            <h4 class="font-bold text-lg text-gray-900">{{ event.name }}</h4>
                            <p class="text-sm text-gray-500">{{ event.category.name }} | {{ event.date }} at {{ event.time }}</p>
                        </div>
                        <div class="flex space-x-3">
                            <a href="{% url 'event-details' event.id %}" class="text-blue-500 font-semibold hover:underline">View</a>
                            <a href="{% url 'update-event' event.id %}" class="text-green-600 font-semibold hover:underline">Edit</a>
                            <form action="{% url 'delete-event' event.id %}" method="POST" onsubmit="return confirm('Delete this event?');" class="inline">
                                {% csrf_token %}
                                <button type="submit" class="text-red-600 font-semibold hover:underline">Delete</button>
                            </form>
                        </div>
                    </div>
                {% endfor %}
            </div>

        {% elif filter_type == 'categories' %}
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                {% for cat in items %}
                    <div class="p-4 border rounded bg-orange-50 flex justify-between items-center shadow-sm">
                        <span class="font-bold text-gray-800">{{ cat.name }} ({{ cat.event_count }})</span>
                        <form action="{% url 'delete-category' cat.id %}" method="POST" onsubmit="return confirm('Delete category?');">
                            {% csrf_token %}
                            <button type="submit" class="text-red-600 text-xs font-bold">Delete</button>
                        </form>
                    </div>
                {% endfor %}
            </div>

        {% elif filter_type == 'groups' %}
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                {% for group in items %}
                    <div class="p-5 border rounded-lg bg-gray-50 flex justify-between items-center">
                        <div>
                            <h4 class="text-lg font-bold text-gray-800">{{ group.name }}</h4>
                            <p class="text-sm text-gray-500">{{ group.user_count }} Total Users</p>
                        </div>
                        <form action="{% url 'delete-group' group.id %}" method="POST" onsubmit="return confirm('Delete role?');">
                            {% csrf_token %}
                            <button type="submit" class="text-red-500 font-bold text-sm hover:underline">Delete Group</button>
                        </form>
                    </div>
                {% endfor %}
            </div>

        {% elif filter_type == 'participants' %}
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse bg-white">
                    <thead class="bg-gray-800 text-white">
                        <tr>
                            <th class="p-4 text-sm font-bold uppercase">User</th>
                            <th class="p-4 text-sm font-bold uppercase">Current Role</th>
                            <th class="p-4 text-sm font-bold uppercase text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        {% for user in items %}
                        <tr class="hover:bg-gray-50 transition">
                            <td class="p-4">
                                <div class="font-bold text-gray-900">{{ user.username }}</div>
                                <div class="text-xs text-gray-500">{{ user.email }}</div>
                            </td>
                            <td class="p-4">
                                {% for group in user.groups.all %}
                                    <span class="bg-blue-100 text-blue-800 text-xs font-bold px-2.5 py-1 rounded-full">{{ group.name }}</span>
                                {% empty %}
                                    <span class="text-gray-400 italic text-sm">No Role</span>
                                {% endfor %}
                            </td>
                            <td class="p-4">
                                <div class="flex items-center justify-center space-x-4">
                                    <form action="{% url 'assign-role' user.id %}" method="POST" class="flex items-center space-x-2">
                                        {% csrf_token %}
                                        <select name="role" class="text-sm border border-gray-300 rounded p-1">
                                            <option value="" disabled selected>Change...</option>
                                            <option value="User">User</option>
                                            <option value="Organizer">Organizer</option>
                                        </select>
                                        <button type="submit" class="bg-orange-500 text-white px-3 py-1 rounded text-xs">Update</button>
                                    </form>
                                    <form action="{% url 'delete-participant' user.id %}" method="POST" onsubmit="return confirm('Delete {{ user.username }}?');">
                                        {% csrf_token %}
                                        <button type="submit" class="text-red-600 font-bold text-xs">Delete</button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %} </div>
</div>

{% endblock content %}